<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cosmic Quiz Arena - Multiplayer Competition</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-purple: #8B5CF6;
            --dark-purple: #6D28D9;
            --darker-purple: #4C1D95;
            --light-purple: #A78BFA;
            --space-dark: #0F0A1F;
            --space-darker: #060112;
            --space-card: #1E1339;
            --accent-cyan: #22D3EE;
            --accent-pink: #EC4899;
            --text-primary: #E9D5FF;
            --text-secondary: #C084FC;
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: var(--space-darker);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Space Background */
        .space-bg {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -2;
            background: linear-gradient(135deg, var(--space-darker) 0%, var(--space-dark) 50%, var(--darker-purple) 100%);
        }
        
        .stars {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 4s infinite;
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }
        
        .nebula {
            position: fixed;
            width: 600px;
            height: 600px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, rgba(139, 92, 246, 0) 70%);
            filter: blur(100px);
            z-index: -1;
            animation: float 20s infinite ease-in-out;
        }
        
        .nebula:nth-child(1) {
            top: -200px;
            right: -200px;
            animation-delay: 0s;
        }
        
        .nebula:nth-child(2) {
            bottom: -200px;
            left: -200px;
            background: radial-gradient(circle, rgba(236, 72, 153, 0.2) 0%, rgba(236, 72, 153, 0) 70%);
            animation-delay: 5s;
        }
        
        .nebula:nth-child(3) {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(34, 211, 238, 0.2) 0%, rgba(34, 211, 238, 0) 70%);
            animation-delay: 10s;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
        }
        
        .shooting-star {
            position: fixed;
            width: 2px;
            height: 2px;
            background: white;
            box-shadow: 0 0 10px 2px rgba(255, 255, 255, 0.8);
            z-index: -1;
            animation: shoot 3s linear infinite;
            opacity: 0;
        }
        
        @keyframes shoot {
            0% {
                transform: translateX(0) translateY(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateX(-500px) translateY(300px);
                opacity: 0;
            }
        }
        
        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            animation: slideDown 0.8s ease;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(45deg, var(--primary-purple), var(--accent-cyan), var(--accent-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(139, 92, 246, 0.5);
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        
        .tagline {
            font-size: 1.2rem;
            color: var(--text-secondary);
            letter-spacing: 1px;
        }
        
        /* Game Container */
        .game-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            animation: fadeIn 1s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Cards */
        .quiz-section, .leaderboard-section {
            background: rgba(30, 19, 57, 0.8);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(139, 92, 246, 0.3), 0 0 0 1px rgba(139, 92, 246, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.2);
        }
        
        /* Screens */
        .room-screen, .lobby-screen, .game-screen, .result-screen {
            display: none;
        }
        
        .room-screen.active, .lobby-screen.active, .game-screen.active, .result-screen.active {
            display: block;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* Room Screen */
        .room-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
        }
        
        .room-input-container {
            width: 100%;
            max-width: 500px;
            margin-bottom: 30px;
        }
        
        .room-input-container label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .room-input {
            width: 100%;
            padding: 15px;
            background: rgba(15, 10, 31, 0.6);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 10px;
            font-size: 1rem;
            color: var(--text-primary);
            transition: all 0.3s;
            text-align: center;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 2px;
        }
        
        .room-input:focus {
            outline: none;
            border-color: var(--primary-purple);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
        }
        
        .room-buttons {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .btn-room {
            flex: 1;
            padding: 15px;
            background: linear-gradient(135deg, var(--primary-purple), var(--dark-purple));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }
        
        .btn-room:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--accent-cyan), var(--primary-purple));
        }
        
        /* Lobby Screen */
        .lobby-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(139, 92, 246, 0.2);
        }
        
        .room-code {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-cyan);
            letter-spacing: 2px;
        }
        
        .player-list {
            margin-bottom: 30px;
        }
        
        .player-list h5 {
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .player-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(15, 10, 31, 0.6);
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid rgba(139, 92, 246, 0.1);
        }
        
        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-purple), var(--accent-cyan));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
        }
        
        .player-name {
            flex: 1;
            font-weight: 600;
        }
        
        .player-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-ready {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        
        .status-waiting {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }
        
        .status-host {
            background: rgba(139, 92, 246, 0.2);
            color: var(--primary-purple);
        }
        
        /* Question Container */
        .question-container {
            margin-bottom: 30px;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .question-number {
            background: linear-gradient(135deg, var(--primary-purple), var(--dark-purple));
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-family: 'Orbitron', sans-serif;
        }
        
        .timer {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .timer-bar {
            width: 100%;
            height: 8px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .timer-progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-purple), var(--accent-cyan));
            border-radius: 10px;
            transition: width 1s linear;
        }
        
        .timer-circle {
            position: relative;
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
        }
        
        .timer-svg {
            transform: rotate(-90deg);
        }
        
        .timer-circle-bg {
            fill: none;
            stroke: rgba(139, 92, 246, 0.2);
            stroke-width: 8;
        }
        
        .timer-circle-progress {
            fill: none;
            stroke: url(#gradient);
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s linear;
        }
        
        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'Orbitron', sans-serif;
        }
        
        .question-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        /* Options */
        .options-container {
            display: grid;
            gap: 15px;
        }
        
        .option {
            padding: 18px;
            background: rgba(15, 10, 31, 0.6);
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .option:hover {
            transform: translateX(5px);
            border-color: var(--primary-purple);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.3);
        }
        
        .option-letter {
            width: 40px;
            height: 40px;
            background: rgba(139, 92, 246, 0.2);
            border: 2px solid var(--primary-purple);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--primary-purple);
            font-family: 'Orbitron', sans-serif;
        }
        
        .option-text {
            flex: 1;
            font-size: 1.1rem;
        }
        
        .option.correct {
            background: rgba(16, 185, 129, 0.2);
            border-color: var(--success);
            animation: correctPulse 0.6s ease;
        }
        
        .option.correct .option-letter {
            background: var(--success);
            color: white;
        }
        
        .option.incorrect {
            background: rgba(239, 68, 68, 0.2);
            border-color: var(--danger);
            animation: shake 0.5s ease;
        }
        
        .option.incorrect .option-letter {
            background: var(--danger);
            color: white;
        }
        
        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        /* Feedback */
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
            animation: slideUp 0.5s ease;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .feedback.correct {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--success);
            color: var(--success);
        }
        
        .feedback.incorrect {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid var(--danger);
            color: var(--danger);
        }
        
        .feedback-emoji {
            font-size: 2rem;
            margin-right: 10px;
        }
        
        /* Leaderboard */
        .leaderboard-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(139, 92, 246, 0.2);
        }
        
        .leaderboard-title {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-purple), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Orbitron', sans-serif;
        }
        
        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(15, 10, 31, 0.6);
            border-radius: 10px;
            transition: all 0.3s;
            border: 1px solid rgba(139, 92, 246, 0.1);
        }
        
        .leaderboard-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.3);
        }
        
        .rank {
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            border-radius: 50%;
            font-family: 'Orbitron', sans-serif;
        }
        
        .rank.gold {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
        }
        
        .rank.silver {
            background: linear-gradient(135deg, #C0C0C0, #808080);
            color: white;
        }
        
        .rank.bronze {
            background: linear-gradient(135deg, #CD7F32, #8B4513);
            color: white;
        }
        
        .rank.other {
            background: rgba(139, 92, 246, 0.2);
            color: var(--text-secondary);
        }
        
        .player-info {
            flex: 1;
        }
        
        .player-name {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .player-score {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .player-points {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-purple);
            font-family: 'Orbitron', sans-serif;
        }
        
        /* Result Screen */
        .result-container {
            text-align: center;
        }
        
        .result-emoji {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: bounce 1s ease infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .result-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(45deg, var(--primary-purple), var(--accent-cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Orbitron', sans-serif;
        }
        
        .result-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            padding: 20px;
            background: rgba(15, 10, 31, 0.6);
            border-radius: 10px;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-purple);
            font-family: 'Orbitron', sans-serif;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }
        
        .btn-restart {
            padding: 15px 40px;
            background: linear-gradient(135deg, var(--primary-purple), var(--dark-purple));
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }
        
        .btn-restart:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(139, 92, 246, 0.4);
        }
        
        /* Confetti */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--primary-purple);
            position: absolute;
            animation: confetti-fall 3s linear;
        }
        
        @keyframes confetti-fall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Loading Animation */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 300px;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(139, 92, 246, 0.2);
            border-top: 5px solid var(--primary-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 1.2rem;
            color: var(--text-secondary);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            background: rgba(30, 19, 57, 0.9);
            border: 1px solid rgba(139, 92, 246, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideInRight 0.5s ease;
            max-width: 300px;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .notification.success {
            border-color: var(--success);
        }
        
        .notification.error {
            border-color: var(--danger);
        }
        
        .notification.info {
            border-color: var(--accent-cyan);
        }
        
        .notification-icon {
            font-size: 1.5rem;
        }
        
        .notification-message {
            flex: 1;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        /* Responsive */
        @media (max-width: 992px) {
            .game-container {
                grid-template-columns: 1fr;
            }
            
            .leaderboard-section {
                order: 2;
            }
        }
        
        @media (max-width: 576px) {
            .logo {
                font-size: 2rem;
            }
            
            .result-stats {
                grid-template-columns: 1fr;
            }
            
            .room-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="space-bg"></div>
    <div class="stars" id="starsContainer"></div>
    <div class="nebula"></div>
    <div class="nebula"></div>
    <div class="nebula"></div>
    <div class="shooting-star" style="top: 20%; right: 20%;"></div>
    <div class="shooting-star" style="top: 40%; right: 50%; animation-delay: 1s;"></div>
    <div class="shooting-star" style="top: 60%; right: 30%; animation-delay: 2s;"></div>
    
    <div class="main-container">
        <header class="header">
            <div class="logo">
                <i class="fas fa-rocket"></i> COSMIC QUIZ ARENA
            </div>
            <div class="tagline">Multiplayer Space Competition 🚀</div>
        </header>
        
        <div class="game-container">
            <section class="quiz-section">
                <!-- Room Screen -->
                <div class="room-screen active">
                    <div class="room-container">
                        <h2 class="mb-4">Join or Create a Room</h2>
                        <div class="room-input-container">
                            <label for="playerName">
                                <i class="fas fa-user-astronaut"></i> Your Name
                            </label>
                            <input type="text" id="playerName" class="room-input" placeholder="Enter your name" maxlength="30">
                        </div>
                        <div class="room-input-container">
                            <label for="roomCode">
                                <i class="fas fa-key"></i> Room Code
                            </label>
                            <input type="text" id="roomCode" class="room-input" placeholder="Enter room code or leave empty to create" maxlength="10">
                        </div>
                        <div class="room-buttons">
                            <button class="btn-room" onclick="joinRoom()">
                                <i class="fas fa-sign-in-alt"></i> Join Room
                            </button>
                            <button class="btn-room btn-secondary" onclick="createRoom()">
                                <i class="fas fa-plus"></i> Create Room
                            </button>
                        </div>
                        <div class="rules-card p-4 rounded" style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.2);">
                            <h5 class="mb-3"><i class="fas fa-info-circle"></i> Competition Rules</h5>
                            <ul class="list-unstyled">
                                <li class="mb-2"><i class="fas fa-check-circle text-success"></i> 50 AI-Generated Questions</li>
                                <li class="mb-2"><i class="fas fa-clock text-warning"></i> 30 seconds per question</li>
                                <li class="mb-2"><i class="fas fa-star text-primary"></i> +10 points for correct answer</li>
                                <li class="mb-2"><i class="fas fa-times-circle text-danger"></i> No points for wrong answer</li>
                                <li class="mb-2"><i class="fas fa-trophy text-warning"></i> Live leaderboard updates!</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Lobby Screen -->
                <div class="lobby-screen">
                    <div class="lobby-header">
                        <div class="room-code">ROOM: <span id="currentRoomCode">XXXXX</span></div>
                        <button class="btn-room btn-sm" onclick="leaveRoom()">
                            <i class="fas fa-sign-out-alt"></i> Leave
                        </button>
                    </div>
                    <div class="player-list">
                        <h5><i class="fas fa-users"></i> Players in Room</h5>
                        <div id="playersList">
                            <!-- Players will be dynamically added -->
                        </div>
                    </div>
                    <div class="text-center">
                        <button class="btn-room" id="startGameBtn" onclick="startGame()" style="display: none;">
                            <i class="fas fa-play"></i> Start Game
                        </button>
                        <div id="waitingMessage" class="mt-3">
                            <i class="fas fa-hourglass-half"></i> Waiting for host to start the game...
                        </div>
                    </div>
                </div>
                
                <!-- Game Screen -->
                <div class="game-screen">
                    <div class="question-container">
                        <div class="question-header">
                            <span class="question-number">Question <span id="currentQuestion">1</span> / 50</span>
                            <div class="timer">
                                <i class="fas fa-clock"></i>
                                <span id="timeLeft">30</span>s
                            </div>
                        </div>
                        
                        <div class="timer-circle">
                            <svg width="80" height="80" class="timer-svg">
                                <defs>
                                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:#8B5CF6;stop-opacity:1" />
                                        <stop offset="100%" style="stop-color:#22D3EE;stop-opacity:1" />
                                    </linearGradient>
                                </defs>
                                <circle cx="40" cy="40" r="36" class="timer-circle-bg"></circle>
                                <circle cx="40" cy="40" r="36" class="timer-circle-progress" 
                                        stroke-dasharray="226" stroke-dashoffset="0"></circle>
                            </svg>
                            <div class="timer-text" id="timerText">30</div>
                        </div>
                        
                        <div class="timer-bar">
                            <div class="timer-progress" id="timerProgress"></div>
                        </div>
                        <div class="question-text" id="questionText">
                            Loading question...
                        </div>
                        <div class="options-container" id="optionsContainer">
                            <!-- Options will be dynamically added -->
                        </div>
                        <div class="feedback" id="feedback">
                            <span class="feedback-emoji" id="feedbackEmoji"></span>
                            <span id="feedbackText"></span>
                        </div>
                    </div>
                </div>
                
                <!-- Result Screen -->
                <div class="result-screen">
                    <div class="result-container">
                        <div class="result-emoji" id="resultEmoji">🎉</div>
                        <h2 class="result-title">Quiz Complete!</h2>
                        <div class="result-stats">
                            <div class="stat-card">
                                <div class="stat-value" id="correctAnswers">0</div>
                                <div class="stat-label">Correct Answers</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="totalScore">0</div>
                                <div class="stat-label">Total Score</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="accuracy">0%</div>
                                <div class="stat-label">Accuracy</div>
                            </div>
                        </div>
                        <button class="btn-restart" onclick="returnToRoom()">
                            <i class="fas fa-redo"></i> Return to Room
                        </button>
                    </div>
                </div>
            </section>
            
            <aside class="leaderboard-section">
                <div class="leaderboard-header">
                    <i class="fas fa-trophy fa-2x" style="color: var(--accent-cyan);"></i>
                    <h2 class="leaderboard-title">Live Leaderboard</h2>
                </div>
                <div class="leaderboard-list" id="leaderboardList">
                    <!-- Leaderboard items will be dynamically added -->
                </div>
            </aside>
        </div>
    </div>
    
    <script>
        // OpenAI API Key (Replace with your actual key)
        const OPENAI_API_KEY = "AIzaSyCvjCDmlLBrGtke3-OGOhEYQMCdgIJakV0"; // Replace with your actual API key
        
        // Game State
        let gameState = {
            currentQuestion: 0,
            score: 0,
            correctAnswers: 0,
            playerName: '',
            roomCode: '',
            isHost: false,
            questions: [],
            timer: null,
            timeLeft: 30,
            isAnswered: false,
            leaderboard: [],
            roomPlayers: [],
            isGeneratingQuestions: false
        };
        
        // Initialize Stars
        function createStars() {
            const starsContainer = document.getElementById('starsContainer');
            const starCount = 200;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 4 + 's';
                starsContainer.appendChild(star);
            }
        }
        
        // Initialize Quiz
        function initQuiz() {
            createStars();
            loadLeaderboard();
        }
        
        // Room Management
        function generateRoomCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }
        
        function createRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                showNotification('Please enter your name!', 'error');
                return;
            }
            
            gameState.playerName = playerName;
            gameState.roomCode = generateRoomCode();
            gameState.isHost = true;
            
            // Initialize room with host
            gameState.roomPlayers = [{
                name: playerName,
                isHost: true,
                isReady: false,
                score: 0,
                correctAnswers: 0
            }];
            
            // Save room to localStorage (simulating backend)
            localStorage.setItem('room_' + gameState.roomCode, JSON.stringify(gameState.roomPlayers));
            
            // Show lobby
            showLobby();
            showNotification(`Room created! Code: ${gameState.roomCode}`, 'success');
        }
        
        function joinRoom() {
            const playerName = document.getElementById('playerName').value.trim();
            const roomCode = document.getElementById('roomCode').value.trim().toUpperCase();
            
            if (!playerName) {
                showNotification('Please enter your name!', 'error');
                return;
            }
            
            if (!roomCode) {
                showNotification('Please enter a room code!', 'error');
                return;
            }
            
            // Check if room exists
            const roomData = localStorage.getItem('room_' + roomCode);
            if (!roomData) {
                showNotification('Room not found!', 'error');
                return;
            }
            
            gameState.playerName = playerName;
            gameState.roomCode = roomCode;
            gameState.isHost = false;
            
            // Add player to room
            gameState.roomPlayers = JSON.parse(roomData);
            
            // Check if player already exists
            const existingPlayer = gameState.roomPlayers.find(p => p.name === playerName);
            if (existingPlayer) {
                showNotification('Player name already exists in this room!', 'error');
                return;
            }
            
            gameState.roomPlayers.push({
                name: playerName,
                isHost: false,
                isReady: false,
                score: 0,
                correctAnswers: 0
            });
            
            // Save updated room
            localStorage.setItem('room_' + gameState.roomCode, JSON.stringify(gameState.roomPlayers));
            
            // Show lobby
            showLobby();
            showNotification(`Joined room: ${gameState.roomCode}`, 'success');
        }
        
        function leaveRoom() {
            // Remove player from room
            if (gameState.roomCode) {
                const roomData = localStorage.getItem('room_' + gameState.roomCode);
                if (roomData) {
                    let roomPlayers = JSON.parse(roomData);
                    roomPlayers = roomPlayers.filter(p => p.name !== gameState.playerName);
                    
                    if (roomPlayers.length === 0) {
                        // Delete room if empty
                        localStorage.removeItem('room_' + gameState.roomCode);
                    } else {
                        // If host left, assign new host
                        if (gameState.isHost && roomPlayers.length > 0) {
                            roomPlayers[0].isHost = true;
                        }
                        localStorage.setItem('room_' + gameState.roomCode, JSON.stringify(roomPlayers));
                    }
                }
            }
            
            // Reset game state
            gameState = {
                currentQuestion: 0,
                score: 0,
                correctAnswers: 0,
                playerName: '',
                roomCode: '',
                isHost: false,
                questions: [],
                timer: null,
                timeLeft: 30,
                isAnswered: false,
                leaderboard: [],
                roomPlayers: [],
                isGeneratingQuestions: false
            };
            
            // Show room screen
            document.querySelector('.lobby-screen').classList.remove('active');
            document.querySelector('.room-screen').classList.add('active');
            
            // Clear inputs
            document.getElementById('playerName').value = '';
            document.getElementById('roomCode').value = '';
        }
        
        function showLobby() {
            document.querySelector('.room-screen').classList.remove('active');
            document.querySelector('.lobby-screen').classList.add('active');
            
            document.getElementById('currentRoomCode').textContent = gameState.roomCode;
            
            updatePlayersList();
            
            // Show/hide start button based on host status
            if (gameState.isHost) {
                document.getElementById('startGameBtn').style.display = 'block';
                document.getElementById('waitingMessage').style.display = 'none';
            } else {
                document.getElementById('startGameBtn').style.display = 'none';
                document.getElementById('waitingMessage').style.display = 'block';
            }
            
            // Start polling for room updates
            pollRoomUpdates();
        }
        
        function updatePlayersList() {
            const playersList = document.getElementById('playersList');
            playersList.innerHTML = '';
            
            gameState.roomPlayers.forEach(player => {
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                
                let statusClass = 'status-waiting';
                let statusText = 'Waiting';
                
                if (player.isHost) {
                    statusClass = 'status-host';
                    statusText = 'Host';
                } else if (player.isReady) {
                    statusClass = 'status-ready';
                    statusText = 'Ready';
                }
                
                playerItem.innerHTML = `
                    <div class="player-avatar">${player.name.charAt(0).toUpperCase()}</div>
                    <div class="player-name">${player.name}</div>
                    <div class="player-status ${statusClass}">${statusText}</div>
                `;
                
                playersList.appendChild(playerItem);
            });
        }
        
        function pollRoomUpdates() {
            // Simulate real-time updates with polling
            const pollInterval = setInterval(() => {
                if (!gameState.roomCode) {
                    clearInterval(pollInterval);
                    return;
                }
                
                const roomData = localStorage.getItem('room_' + gameState.roomCode);
                if (roomData) {
                    const roomPlayers = JSON.parse(roomData);
                    
                    // Check if game started
                    if (roomPlayers.some(p => p.gameStarted)) {
                        clearInterval(pollInterval);
                        startGameAsPlayer();
                        return;
                    }
                    
                    // Update players list if changed
                    if (JSON.stringify(roomPlayers) !== JSON.stringify(gameState.roomPlayers)) {
                        gameState.roomPlayers = roomPlayers;
                        updatePlayersList();
                    }
                } else {
                    // Room was deleted
                    clearInterval(pollInterval);
                    showNotification('Room was closed by host', 'info');
                    leaveRoom();
                }
            }, 1000);
        }
        
        function startGame() {
            if (!gameState.isHost) return;
            
            // Mark game as started in room data
            gameState.roomPlayers.forEach(p => p.gameStarted = true);
            localStorage.setItem('room_' + gameState.roomCode, JSON.stringify(gameState.roomPlayers));
            
            // Initialize game
            gameState.currentQuestion = 0;
            gameState.score = 0;
            gameState.correctAnswers = 0;
            
            document.querySelector('.lobby-screen').classList.remove('active');
            document.querySelector('.game-screen').classList.add('active');
            
            // Generate questions with AI
            generateQuestionsWithAI();
        }
        
        function startGameAsPlayer() {
            // Initialize game for non-host players
            gameState.currentQuestion = 0;
            gameState.score = 0;
            gameState.correctAnswers = 0;
            
            document.querySelector('.lobby-screen').classList.remove('active');
            document.querySelector('.game-screen').classList.add('active');
            
            // Generate questions with AI
            generateQuestionsWithAI();
        }
        
        // Generate Questions with AI
        async function generateQuestionsWithAI() {
            if (gameState.isGeneratingQuestions) return;
            
            gameState.isGeneratingQuestions = true;
            
            // Show loading state
            document.getElementById('questionText').textContent = 'Generating cosmic questions with AI...';
            document.getElementById('optionsContainer').innerHTML = `
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Preparing your quiz journey...</div>
                </div>
            `;
            
            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are a quiz question generator for a space-themed quiz competition. Generate 50 diverse multiple-choice questions with 4 options each. Include a mix of general knowledge, space, technology, and aptitude questions (logical reasoning, mathematical problems, pattern recognition). Format your response as a JSON array with each question having: "question" (the question text), "options" (array of 4 strings), and "correct" (index of correct option, 0-3).'
                            },
                            {
                                role: 'user',
                                content: 'Generate 50 quiz questions in JSON format as described above. Include both general knowledge and aptitude questions.'
                            }
                        ],
                        max_tokens: 4000,
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }
                
                const data = await response.json();
                const content = data.choices[0].message.content;
                
                // Parse the JSON response
                let questions;
                try {
                    // Try to extract JSON from the response
                    const jsonMatch = content.match(/\[[\s\S]*\]/);
                    if (jsonMatch) {
                        questions = JSON.parse(jsonMatch[0]);
                    } else {
                        throw new Error('No valid JSON found in response');
                    }
                } catch (parseError) {
                    console.error('Error parsing AI response:', parseError);
                    // Fallback to default questions if parsing fails
                    questions = getDefaultQuestions();
                }
                
                gameState.questions = questions.slice(0, 50); // Ensure we have exactly 50 questions
                gameState.isGeneratingQuestions = false;
                
                // Display the first question
                displayQuestion();
                
            } catch (error) {
                console.error('Error generating questions:', error);
                gameState.isGeneratingQuestions = false;
                
                // Show error notification
                showNotification('Failed to generate questions with AI. Using default questions.', 'error');
                
                // Fallback to default questions
                gameState.questions = getDefaultQuestions();
                displayQuestion();
            }
        }
        
        // Default Questions (Fallback)
        function getDefaultQuestions() {
            return [
                {
                    question: "What is the largest planet in our solar system? 🪐",
                    options: ["Earth", "Mars", "Jupiter", "Saturn"],
                    correct: 2
                },
                {
                    question: "If a train travels 60 km in 1 hour, how far will it travel in 3 hours? 🚂",
                    options: ["120 km", "180 km", "240 km", "300 km"],
                    correct: 1
                },
                {
                    question: "Who was the first person to walk on the moon? 🚀",
                    options: ["Buzz Aldrin", "Neil Armstrong", "Yuri Gagarin", "John Glenn"],
                    correct: 1
                },
                {
                    question: "What is the next number in the sequence: 2, 6, 12, 20, 30, ? 🔢",
                    options: ["40", "42", "44", "46"],
                    correct: 1
                },
                {
                    question: "What is the speed of light? 💡",
                    options: ["299,792 km/s", "199,792 km/s", "399,792 km/s", "499,792 km/s"],
                    correct: 0
                },
                {
                    question: "If a shirt costs $40 and is on sale for 25% off, what is the final price? 💰",
                    options: ["$10", "$20", "$30", "$35"],
                    correct: 2
                },
                {
                    question: "Which galaxy is Earth located in? 🌌",
                    options: ["Andromeda", "Milky Way", "Whirlpool", "Sombrero"],
                    correct: 1
                },
                {
                    question: "What is the cube of 5? 🔢",
                    options: ["25", "50", "125", "250"],
                    correct: 2
                },
                {
                    question: "What is the hottest planet in our solar system? 🔥",
                    options: ["Mercury", "Venus", "Mars", "Jupiter"],
                    correct: 1
                },
                {
                    question: "If a rectangle has a length of 8 cm and width of 5 cm, what is its area? 📐",
                    options: ["13 cm²", "40 cm²", "26 cm²", "32 cm²"],
                    correct: 1
                },
                {
                    question: "How many moons does Jupiter have? 🌙",
                    options: ["4", "12", "79", "95"],
                    correct: 2
                },
                {
                    question: "What is 15% of 200? 🔢",
                    options: ["15", "20", "30", "40"],
                    correct: 2
                },
                {
                    question: "What is the name of the nearest star to Earth? ⭐",
                    options: ["Proxima Centauri", "Alpha Centauri", "Sirius", "The Sun"],
                    correct: 3
                },
                {
                    question: "If x + 5 = 12, what is the value of x? 🔢",
                    options: ["5", "6", "7", "8"],
                    correct: 2
                },
                {
                    question: "What is the smallest planet in our solar system? 🪐",
                    options: ["Mercury", "Venus", "Mars", "Pluto"],
                    correct: 0
                },
                {
                    question: "What is the square root of 144? 🔢",
                    options: ["10", "11", "12", "13"],
                    correct: 2
                },
                {
                    question: "What causes the phases of the Moon? 🌓",
                    options: ["Earth's shadow", "Sun's position", "Moon's orbit around Earth", "Earth's rotation"],
                    correct: 2
                },
                {
                    question: "If a car travels at 60 km/h for 2.5 hours, how far does it travel? 🚗",
                    options: ["120 km", "150 km", "180 km", "200 km"],
                    correct: 1
                },
                {
                    question: "What is the largest moon in our solar system? 🌕",
                    options: ["Titan", "Ganymede", "Europa", "Callisto"],
                    correct: 1
                },
                {
                    question: "What is 25% of 80? 🔢",
                    options: ["10", "15", "20", "25"],
                    correct: 2
                },
                {
                    question: "What is the name of the supermassive black hole at the center of our galaxy? 🕳️",
                    options: ["Sagittarius A*", "Cygnus X-1", "M87*", "V404 Cygni"],
                    correct: 0
                },
                {
                    question: "If a triangle has angles of 45° and 65°, what is the third angle? 📐",
                    options: ["60°", "70°", "80°", "90°"],
                    correct: 1
                },
                {
                    question: "How long does it take for light from the Sun to reach Earth? ☀️",
                    options: ["8 seconds", "8 minutes", "8 hours", "8 days"],
                    correct: 1
                },
                {
                    question: "What is the next number in the sequence: 1, 4, 9, 16, 25, ? 🔢",
                    options: ["30", "36", "42", "49"],
                    correct: 1
                },
                {
                    question: "What is the main component of the Sun's composition? ☀️",
                    options: ["Oxygen", "Carbon", "Hydrogen", "Nitrogen"],
                    correct: 2
                },
                {
                    question: "If 3x + 7 = 19, what is the value of x? 🔢",
                    options: ["2", "3", "4", "5"],
                    correct: 2
                },
                {
                    question: "What is the name of NASA's Mars rover that landed in 2021? 🚗",
                    options: ["Curiosity", "Opportunity", "Perseverance", "Spirit"],
                    correct: 2
                },
                {
                    question: "What is 20% of 150? 🔢",
                    options: ["20", "25", "30", "35"],
                    correct: 2
                },
                {
                    question: "What is the Oort Cloud? ☁️",
                    options: ["A nebula", "A spherical shell of icy objects", "A galaxy", "A star cluster"],
                    correct: 1
                },
                {
                    question: "If a circle has a radius of 5 cm, what is its circumference? (π ≈ 3.14) 📐",
                    options: ["15.7 cm", "31.4 cm", "47.1 cm", "62.8 cm"],
                    correct: 1
                },
                {
                    question: "What is the diameter of Earth? 🌍",
                    options: ["6,371 km", "12,742 km", "20,000 km", "40,000 km"],
                    correct: 1
                },
                {
                    question: "What is the next number in the sequence: 3, 6, 11, 18, 27, ? 🔢",
                    options: ["36", "38", "40", "42"],
                    correct: 1
                },
                {
                    question: "What is the name of the first satellite sent into space? 🛰️",
                    options: ["Explorer 1", "Sputnik 1", "Vanguard 1", "Luna 1"],
                    correct: 1
                },
                {
                    question: "If a box has dimensions 4m × 3m × 2m, what is its volume? 📦",
                    options: ["9 m³", "12 m³", "24 m³", "48 m³"],
                    correct: 2
                },
                {
                    question: "What is the Great Red Spot on Jupiter? 🌀",
                    options: ["A volcano", "A storm", "A crater", "An ocean"],
                    correct: 1
                },
                {
                    question: "What is 3/4 of 80? 🔢",
                    options: ["40", "50", "60", "70"],
                    correct: 2
                },
                {
                    question: "What is the name of the first woman in space? 👩‍🚀",
                    options: ["Sally Ride", "Valentina Tereshkova", "Mae Jemison", "Christa McAuliffe"],
                    correct: 1
                },
                {
                    question: "If 5y - 10 = 15, what is the value of y? 🔢",
                    options: ["3", "4", "5", "6"],
                    correct: 2
                },
                {
                    question: "What is the escape velocity from Earth? 🚀",
                    options: ["7.9 km/s", "11.2 km/s", "15.5 km/s", "20.1 km/s"],
                    correct: 1
                },
                {
                    question: "What is the next number in the sequence: 2, 3, 5, 8, 13, ? 🔢",
                    options: ["18", "19", "20", "21"],
                    correct: 3
                },
                {
                    question: "What is the name of the constellation also known as the Hunter? 🌟",
                    options: ["Ursa Major", "Orion", "Cassiopeia", "Leo"],
                    correct: 1
                },
                {
                    question: "If a rectangle has a perimeter of 30 cm and a length of 10 cm, what is its width? 📐",
                    options: ["3 cm", "5 cm", "7 cm", "10 cm"],
                    correct: 1
                },
                {
                    question: "What is the main cause of auroras (Northern and Southern Lights)? 🌌",
                    options: ["Moonlight", "Solar wind interacting with Earth's magnetic field", "Reflection from ice caps", "Lightning storms"],
                    correct: 1
                },
                {
                    question: "What is 15% of 300? 🔢",
                    options: ["30", "35", "40", "45"],
                    correct: 3
                },
                {
                    question: "What is the name of the theory that explains the origin of the universe? 🌌",
                    options: ["Theory of Relativity", "Big Bang Theory", "String Theory", "Quantum Theory"],
                    correct: 1
                },
                {
                    question: "If a cube has a volume of 64 cm³, what is the length of each side? 📦",
                    options: ["2 cm", "3 cm", "4 cm", "5 cm"],
                    correct: 2
                },
                {
                    question: "What is the name of the first space station? 🛰️",
                    options: ["International Space Station", "Skylab", "Mir", "Salyut 1"],
                    correct: 3
                },
                {
                    question: "What is the next number in the sequence: 10, 8, 13, 11, 16, ? 🔢",
                    options: ["12", "14", "18", "20"],
                    correct: 1
                },
                {
                    question: "What is the name of the phenomenon where light bends around a massive object? 🌌",
                    options: ["Refraction", "Reflection", "Gravitational lensing", "Diffraction"],
                    correct: 2
                },
                {
                    question: "If 2x + 3y = 17 and x = 4, what is the value of y? 🔢",
                    options: ["1", "2", "3", "4"],
                    correct: 2
                },
                {
                    question: "What is the name of the spacecraft that carried the first humans to the Moon? 🚀",
                    options: ["Apollo 11", "Gemini 4", "Mercury 7", "Vostok 1"],
                    correct: 0
                },
                {
                    question: "What is 40% of 120? 🔢",
                    options: ["36", "40", "48", "56"],
                    correct: 2
                },
                {
                    question: "What is the name of the largest volcano in our solar system? 🌋",
                    options: ["Mount Everest", "Olympus Mons", "Mauna Kea", "Mount Vesuvius"],
                    correct: 1
                },
                {
                    question: "If a triangle has sides of 5 cm, 12 cm, and 13 cm, what type of triangle is it? 📐",
                    options: ["Equilateral", "Isosceles", "Right-angled", "Scalene"],
                    correct: 2
                }
            ];
        }
        
        // Display Question
        function displayQuestion() {
            if (gameState.currentQuestion >= gameState.questions.length) {
                endQuiz();
                return;
            }
            
            const question = gameState.questions[gameState.currentQuestion];
            document.getElementById('currentQuestion').textContent = gameState.currentQuestion + 1;
            document.getElementById('questionText').textContent = question.question;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                optionElement.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(optionElement);
            });
            
            // Reset timer
            gameState.timeLeft = 30;
            gameState.isAnswered = false;
            startTimer();
            
            // Hide feedback
            document.getElementById('feedback').style.display = 'none';
        }
        
        // Start Timer
        function startTimer() {
            clearInterval(gameState.timer);
            updateTimerDisplay();
            
            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                updateTimerDisplay();
                
                if (gameState.timeLeft <= 0) {
                    clearInterval(gameState.timer);
                    if (!gameState.isAnswered) {
                        selectAnswer(-1); // Time's up
                    }
                }
            }, 1000);
        }
        
        // Update Timer Display
        function updateTimerDisplay() {
            document.getElementById('timeLeft').textContent = gameState.timeLeft;
            document.getElementById('timerText').textContent = gameState.timeLeft;
            
            const progress = (gameState.timeLeft / 30) * 100;
            document.getElementById('timerProgress').style.width = progress + '%';
            
            // Update circular timer
            const circumference = 2 * Math.PI * 36;
            const offset = circumference - (gameState.timeLeft / 30) * circumference;
            document.querySelector('.timer-circle-progress').style.strokeDashoffset = offset;
            
            // Change color based on time left
            if (gameState.timeLeft <= 10) {
                document.getElementById('timerProgress').style.background = 'linear-gradient(90deg, #EF4444, #F97316)';
                document.querySelector('.timer-text').style.color = '#EF4444';
            } else if (gameState.timeLeft <= 20) {
                document.getElementById('timerProgress').style.background = 'linear-gradient(90deg, #F97316, #FBBF24)';
                document.querySelector('.timer-text').style.color = '#F59E0B';
            } else {
                document.getElementById('timerProgress').style.background = 'linear-gradient(90deg, #8B5CF6, #22D3EE)';
                document.querySelector('.timer-text').style.color = '#E9D5FF';
            }
        }
        
        // Select Answer
        function selectAnswer(selectedIndex) {
            if (gameState.isAnswered) return;
            
            clearInterval(gameState.timer);
            gameState.isAnswered = true;
            
            const question = gameState.questions[gameState.currentQuestion];
            const options = document.querySelectorAll('.option');
            const feedback = document.getElementById('feedback');
            const feedbackEmoji = document.getElementById('feedbackEmoji');
            const feedbackText = document.getElementById('feedbackText');
            
            // Disable all options
            options.forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            if (selectedIndex === question.correct) {
                // Correct answer
                options[selectedIndex].classList.add('correct');
                gameState.score += 10;
                gameState.correctAnswers++;
                
                feedback.className = 'feedback correct';
                feedbackEmoji.textContent = '🎉';
                feedbackText.textContent = 'Correct! Well done!';
                
                // Add celebration effect
                createConfetti();
            } else {
                // Wrong answer
                if (selectedIndex >= 0) {
                    options[selectedIndex].classList.add('incorrect');
                }
                options[question.correct].classList.add('correct');
                
                feedback.className = 'feedback incorrect';
                feedbackEmoji.textContent = '😔';
                feedbackText.textContent = selectedIndex >= 0 ? 
                    `Wrong! The correct answer is ${String.fromCharCode(65 + question.correct)}: ${question.options[question.correct]}` :
                    `Time's up! The correct answer is ${String.fromCharCode(65 + question.correct)}: ${question.options[question.correct]}`;
            }
            
            feedback.style.display = 'block';
            
            // Update leaderboard after each question
            updateLeaderboardAfterQuestion();
            
            // Move to next question after delay
            setTimeout(() => {
                gameState.currentQuestion++;
                displayQuestion();
            }, 2500);
        }
        
        // Update Leaderboard After Each Question
        function updateLeaderboardAfterQuestion() {
            // Find if player is already in leaderboard
            const existingIndex = gameState.leaderboard.findIndex(p => p.name === gameState.playerName);
            
            const playerData = {
                name: gameState.playerName,
                score: gameState.score,
                correct: gameState.correctAnswers,
                total: gameState.currentQuestion + 1,
                accuracy: Math.round((gameState.correctAnswers / (gameState.currentQuestion + 1)) * 100),
                isCurrentPlayer: true
            };
            
            if (existingIndex >= 0) {
                gameState.leaderboard[existingIndex] = playerData;
            } else {
                gameState.leaderboard.push(playerData);
            }
            
            // Sort leaderboard
            gameState.leaderboard.sort((a, b) => b.score - a.score);
            
            // Keep only top 10
            gameState.leaderboard = gameState.leaderboard.slice(0, 10);
            
            // Display leaderboard
            displayLeaderboard();
        }
        
        // Create Confetti Effect
        function createConfetti() {
            const colors = ['#8B5CF6', '#A78BFA', '#C4B5FD', '#DDD6FE', '#EDE9FE', '#22D3EE', '#67E8F9', '#A5F3FC', '#CFFAFE', '#EC4899', '#F472B6', '#F9A8D4'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3000);
                }, i * 30);
            }
        }
        
        // End Quiz
        function endQuiz() {
            clearInterval(gameState.timer);
            
            document.querySelector('.game-screen').classList.remove('active');
            document.querySelector('.result-screen').classList.add('active');
            
            // Calculate results
            const accuracy = Math.round((gameState.correctAnswers / gameState.questions.length) * 100);
            
            document.getElementById('correctAnswers').textContent = gameState.correctAnswers;
            document.getElementById('totalScore').textContent = gameState.score;
            document.getElementById('accuracy').textContent = accuracy + '%';
            
            // Set result emoji based on performance
            const resultEmoji = document.getElementById('resultEmoji');
            if (accuracy >= 80) {
                resultEmoji.textContent = '🏆';
                createConfetti();
            } else if (accuracy >= 60) {
                resultEmoji.textContent = '🎉';
            } else if (accuracy >= 40) {
                resultEmoji.textContent = '😊';
            } else {
                resultEmoji.textContent = '💪';
            }
            
            // Update final leaderboard
            updateLeaderboard();
        }
        
        // Update Leaderboard
        function updateLeaderboard() {
            const player = {
                name: gameState.playerName,
                score: gameState.score,
                correct: gameState.correctAnswers,
                total: gameState.questions.length,
                accuracy: Math.round((gameState.correctAnswers / gameState.questions.length) * 100),
                isCurrentPlayer: false
            };
            
            // Check if player already exists
            const existingIndex = gameState.leaderboard.findIndex(p => p.name === player.name);
            if (existingIndex >= 0) {
                if (player.score > gameState.leaderboard[existingIndex].score) {
                    gameState.leaderboard[existingIndex] = player;
                }
            } else {
                gameState.leaderboard.push(player);
            }
            
            // Sort leaderboard
            gameState.leaderboard.sort((a, b) => b.score - a.score);
            
            // Keep only top 10
            gameState.leaderboard = gameState.leaderboard.slice(0, 10);
            
            // Save to localStorage
            localStorage.setItem('quizLeaderboard', JSON.stringify(gameState.leaderboard));
            
            // Display leaderboard
            displayLeaderboard();
        }
        
        // Load Leaderboard
        function loadLeaderboard() {
            const saved = localStorage.getItem('quizLeaderboard');
            if (saved) {
                gameState.leaderboard = JSON.parse(saved);
                displayLeaderboard();
            }
        }
        
        // Display Leaderboard
        function displayLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = '';
            
            if (gameState.leaderboard.length === 0) {
                leaderboardList.innerHTML = '<p class="text-center text-secondary">No scores yet. Be the first!</p>';
                return;
            }
            
            gameState.leaderboard.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                
                // Highlight current player
                if (player.isCurrentPlayer) {
                    item.style.background = 'rgba(139, 92, 246, 0.2)';
                    item.style.borderColor = 'rgba(139, 92, 246, 0.5)';
                }
                
                let rankClass = 'other';
                if (index === 0) rankClass = 'gold';
                else if (index === 1) rankClass = 'silver';
                else if (index === 2) rankClass = 'bronze';
                
                item.innerHTML = `
                    <div class="rank ${rankClass}">${index + 1}</div>
                    <div class="player-info">
                        <div class="player-name">${player.name} ${player.isCurrentPlayer ? '(You)' : ''}</div>
                        <div class="player-score">${player.correct}/${player.total || 50} correct • ${player.accuracy}%</div>
                    </div>
                    <div class="player-points">${player.score} pts</div>
                `;
                
                leaderboardList.appendChild(item);
            });
        }
        
        // Return to Room
        function returnToRoom() {
            document.querySelector('.result-screen').classList.remove('active');
            document.querySelector('.lobby-screen').classList.add('active');
            
            // Reset game state for next round
            gameState.currentQuestion = 0;
            gameState.score = 0;
            gameState.correctAnswers = 0;
            gameState.questions = [];
            
            // Update players list
            updatePlayersList();
        }
        
        // Show Notification
        function showNotification(message, type) {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = '';
            if (type === 'success') icon = '<i class="fas fa-check-circle notification-icon" style="color: var(--success);"></i>';
            else if (type === 'error') icon = '<i class="fas fa-exclamation-circle notification-icon" style="color: var(--danger);"></i>';
            else icon = '<i class="fas fa-info-circle notification-icon" style="color: var(--accent-cyan);"></i>';
            
            notification.innerHTML = `
                ${icon}
                <div class="notification-message">${message}</div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', initQuiz);
    </script>
</body>
</html>
